pipeline {
  agent any
  // environment {
  //     DOCKER_USER=credentials('docker-user')
  //     DOCKER_PASSWORD=credentials('docker-pass')
  //     DATABASE_URI=credentials('DATABASE_URI')
  //     TEST_DATABASE_URI=credentials('TEST_DATABASE_URI')
  //     SECRET_KEY=credentials('SECRET_KEY')
  //     TEST_IP=credentials('TEST_IP')
  // }
  stages {
    stage('Run tests') {
      steps {
      sh "ssh -i /home/jenkins/.ssh/id_rsa ubuntu@34.246.161.244"
      sh "chmod a+x ./scripts/testscript.sh"
      sh "sudo bash ./scripts/testscript.sh"
      }
      }
    stage('Push images to dockerhub') {
      steps {
      sh "chmod a+x ./scripts/dockerhub.sh"
      sh "./scripts/dockerhub.sh"
      }
      }  
    stage('Deploy kubernetes') {
      steps {
      sh "chmod a+x ./scripts/deploykube.sh"
      sh "./scripts/deploykube.sh"
      }
      }
  }
}